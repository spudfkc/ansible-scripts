---
  - name: Download latest nodejs source
    get_url: url=http://nodejs.org/dist/node-latest.tar.gz dest=/tmp/node-latest.tar.gz

  - name: Extract
    unarchive: src=./node-latest.tar.gz dest=/tmp copy=no

  - name: ensure install dir exists
    sudo: True
    file: path=/home/{{ username }}/local state=directory

  - name: Configure
    command: chdir=/tmp/node-latest-install ./configure --prefix=/home/{{ username }}/local

  - name: Make
    command: chdir=/tmp/node-latest-install make

  - name: Make Install
    sudo: True
    command: chdir=/tmp/node-latest-install make install

  - name: Download NPM installer
    get_url: url=https://www.npmjs.org/install.sh dest=/tmp/npm-install.sh

  - name: Install NPM
    sudo: True
    command: chdir=/tmp sh ./npm-install.sh

  - name: Chown ~
    sudo: True
    command: chown -R {{ username }}:{{ username }} /home/{{ username }}/
